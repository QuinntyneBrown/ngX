﻿<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Component LifeCycle</title>
</head>
<body data-ng-app="app">
    <my-app></my-app>
    <script src="../../node_modules/angular/angular.min.js"></script>
    <script src="../../node_modules/angular-route/angular-route.min.js"></script>
    <script src="../../dist/ngX.js"></script>
    <script>
        angular.module("app", ["ngX"])
            .config(["$routeProvider", function ($routeProvider) {
                $routeProvider.when("/", {
                    componentName: "homeComponent",
                    componentTemplateUrl: "/examples/componentLifeCycle/home.component.html"
                });

                $routeProvider.when("/about", {
                    componentName: "aboutComponent",
                    componentTemplateUrl: "/examples/componentLifeCycle/about.component.html"
                });

                $routeProvider.when("/override", {
                    resolve: {
                        override: [
                            "$location", "$q", function($location, $q) {
                                var deferred = $q.defer();

                                $location.path("/");
                                deferred.reject();
                                return deferred.promise;

                            }
                        ]
                    }
                });

            }]);



        function HomeComponent($q, routeData) {

            return {
                title: routeData.home.title,
                onInit: function () { console.log("onInit"); },
                canDeactivate: function () {
                    console.log("canDeactivate");
                    return $q.when(true);
                },
                deactivate: function () { console.log("deactivate"); }
            }
        }

        /* static */
        HomeComponent.canActivate = function () {
            return ["$q", function ($q) {
                console.log("can Activate: resolving promise...");
                var deferred = $q.defer();
                setTimeout(function () {
                    console.log("can Activate: promise resolved...");
                    return deferred.resolve({ title: "Home" });
                }, 0);
                return deferred.promise;
            }];
        }

        ngX.Component({
            component: HomeComponent,
            providers: ["$q", "routeData"],
            route: "/",
            key: "home",
            template: [
                " <div> ",
                "     <h1>{{ ::vm.title }}</h1> ",
                " </div> "
            ].join(" ")
        });

        function AboutComponent() {
            return { title: "About" }
        }

        ngX.Component({
            component: AboutComponent,
            template: [
                " <div> ",
                "     <h1>Change: {{ ::vm.title }}</h1> ",
                " </div> "
            ].join(" ")
        });


        function AppComponent() { }

        ngX.Component({
            selector: "my-app",
            component: AppComponent,
            template: [
                "<div>",
                "<app-header/>",
                "<div data-ng-view></div>",
                "</div>"
            ].join(" ")
        });

        function HeaderComponent() { }

        ngX.Component({
            selector: "app-header",
            component: HeaderComponent,
            template: [
                "<div>",
                "<a href='#/'>Home</a>",
                "<a href='#/about'>About</a>",
                "</div>"
            ].join(" ")
        });


    </script>
</body>
</html>
